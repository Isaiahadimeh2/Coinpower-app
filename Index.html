<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoinPower | Secure Mining</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    <style>
        :root { --gold: #b8860b; --p-green: #28a745; --dark: #1a1a1a; --danger: #d9534f; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding-bottom: 80px; background: #f4f7f6; color: #333; }
        .container { max-width: 450px; margin: auto; padding: 20px; }
        .hidden { display: none !important; }
        
        /* Headers */
        .auth-header { text-align: center; padding: 40px 20px; background: white; border-bottom: 2px solid var(--gold); }
        .logo-large { width: 120px; height: 120px; border-radius: 50%; box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
        .dash-header { background: linear-gradient(135deg, #111 0%, #333 100%); color: white; padding: 30px; border-radius: 0 0 25px 25px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        
        /* Components */
        .card { background: white; border-radius: 18px; padding: 20px; margin: 15px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border: 1px solid #eee; }
        .btn { border: none; padding: 15px; border-radius: 12px; cursor: pointer; width: 100%; font-weight: bold; text-transform: uppercase; transition: 0.2s; margin-top: 10px; }
        .btn-p { background: var(--p-green); color: white; }
        .btn-g { background: var(--gold); color: white; }
        .btn-w { background: #555; color: white; }
        
        input, select { width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; background: #fafafa; }
        .timer-label { color: var(--danger); font-weight: bold; font-size: 0.9em; margin-top: 10px; text-align: center; }
        .nav-links { display: flex; justify-content: space-between; margin-top: 15px; font-size: 0.85em; color: #666; }
    </style>
</head>
<body>

    <div id="auth-page">
        <div class="auth-header">
            <img src="3611.jpg" class="logo-large" onerror="this.src='https://via.placeholder.com/120'">
            <h2 style="color: var(--gold); margin-top:15px;">DIGITAL ENERGY</h2>
        </div>
        
        <div class="container">
            <div id="reg-box" class="card">
                <h3 style="text-align:center">Register Runner</h3>
                <input type="text" id="reg-user" placeholder="Full Name">
                <input type="text" id="reg-phone" placeholder="Phone (e.g. 233...)">
                <input type="password" id="reg-pin" maxlength="4" placeholder="4-Digit Security PIN">
                <button class="btn btn-p" onclick="register()">Create Account</button>
                <div class="nav-links">
                    <span onclick="toggleAuth(false)" style="cursor:pointer">Already have an account? <b>Login</b></span>
                </div>
            </div>

            <div id="login-box" class="card hidden">
                <h3 style="text-align:center">Secure Login</h3>
                <input type="text" id="login-phone" placeholder="Phone Number">
                <input type="password" id="login-pin" maxlength="4" placeholder="4-Digit PIN">
                <button class="btn btn-g" onclick="login()">Enter Console</button>
                <div class="nav-links">
                    <span onclick="toggleAuth(true)" style="cursor:pointer">Need an account? <b>Register</b></span>
                </div>
            </div>
        </div>
    </div>

    <div id="main-page" class="hidden">
        <div class="dash-header">
            <h4 style="margin:0; opacity:0.8; font-weight:normal;">AVAILABLE BALANCE</h4>
            <h1 id="display-balance" style="color: #ffc107; font-size: 2.5em; margin: 10px 0;">$0.00</h1>
            <p id="display-name" style="font-size:0.9em; color:var(--p-green)"></p>
        </div>

        <div class="container">
            <div class="card" style="text-align:center;">
                <h3 style="margin-top:0">PG1 Global Unit</h3>
                <p style="font-size: 0.8em; color:#888">Daily Yield: $1.00</p>
                <button id="btn-claim-pg" class="btn btn-p" onclick="claimDaily()">Start Mining</button>
                <div id="timer-text" class="timer-label"></div>
            </div>

            <div class="card">
                <h3 style="margin-top:0">Withdrawal</h3>
                <input type="number" id="withdraw-amount" placeholder="Amount to Withdraw">
                <input type="text" id="withdraw-address" placeholder="Wallet Address / Phone">
                <button class="btn btn-w" onclick="requestWithdraw()">Request Payout</button>
            </div>

            <button class="btn" style="background:#25D366; color:white" onclick="window.open('https://wa.me/YOURNUMBER')">ðŸ’¬ WhatsApp Support</button>
            <button class="btn btn-w" style="margin-top:20px; background:#eee; color:#333" onclick="location.reload()">Sign Out</button>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "...",
            appId: "..."
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let userData = null;

        // --- 2. AUTH FUNCTIONS ---
        function toggleAuth(showReg) {
            document.getElementById('reg-box').classList.toggle('hidden', !showReg);
            document.getElementById('login-box').classList.toggle('hidden', showReg);
        }

        async function register() {
            const phone = document.getElementById('reg-phone').value.trim();
            const user = document.getElementById('reg-user').value.trim();
            const pin = document.getElementById('reg-pin').value;

            if(!phone || !user || pin.length < 4) return alert("Fill all fields correctly.");

            const check = await db.collection("users").doc(phone).get();
            if(check.exists) return alert("Phone already registered.");

            userData = { 
                username: user, 
                phone: phone, 
                pin: pin, 
                balance: 1.0, 
                lastClaim: 0,
                createdAt: Date.now()
            };

            await db.collection("users").doc(phone).set(userData);
            showDashboard();
        }

        async function login() {
            const phone = document.getElementById('login-phone').value.trim();
            const pin = document.getElementById('login-pin').value;

            const doc = await db.collection("users").doc(phone).get();
            if(doc.exists && doc.data().pin === pin) {
                userData = doc.data();
                showDashboard();
            } else {
                alert("Invalid Credentials.");
            }
        }

        // --- 3. CORE LOGIC ---
        function showDashboard() {
            document.getElementById('auth-page').classList.add('hidden');
            document.getElementById('main-page').classList.remove('hidden');
            document.getElementById('display-name').innerText = "Logged in as: " + userData.username;
            updateUI();
            startTimer();
        }

        async function claimDaily() {
            const now = Date.now();
            if(now - userData.lastClaim < 86400000) return alert("Mining in progress...");

            userData.balance += 1.0;
            userData.lastClaim = now;
            
            await db.collection("users").doc(userData.phone).update({
                balance: userData.balance,
                lastClaim: userData.lastClaim
            });
            updateUI();
        }

        async function requestWithdraw() {
            const amt = parseFloat(document.getElementById('withdraw-amount').value);
            if(amt > userData.balance || amt < 5) return alert("Insufficient balance (Min $5).");

            // Logic to send a 'notification' to your Admin/Master Console
            await db.collection("withdrawals").add({
                user: userData.phone,
                amount: amt,
                address: document.getElementById('withdraw-address').value,
                status: "pending",
                time: Date.now()
            });

            userData.balance -= amt;
            await db.collection("users").doc(userData.phone).update({ balance: userData.balance });
            alert("Request Sent to Master Console.");
            updateUI();
        }

        function updateUI() {
            document.getElementById('display-balance').innerText = "$" + userData.balance.toFixed(2);
        }

        function startTimer() {
            setInterval(() => {
                const diff = 86400000 - (Date.now() - userData.lastClaim);
                const btn = document.getElementById('btn-claim-pg');
                if(diff > 0) {
                    const hours = Math.floor(diff / 3600000);
                    const mins = Math.floor((diff % 3600000) / 60000);
                    document.getElementById('timer-text').innerText = `Next claim in: ${hours}h ${mins}m`;
                    btn.disabled = true;
                    btn.style.opacity = "0.5";
                } else {
                    document.getElementById('timer-text').innerText = "System Ready!";
                    btn.disabled = false;
                    btn.style.opacity = "1";
                }
            }, 1000);
        }
    </script>
</body>
</html>
